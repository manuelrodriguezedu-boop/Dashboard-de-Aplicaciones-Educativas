<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" /><title>Editar Reto - RazonaApp</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>/* ... (El CSS es idéntico al de crear_reto.html) ... */</style>
</head>
<body>

  <header><!-- ... (Cabecera del módulo profesor) ... --></header>
  <nav><!-- ... (Navegación del módulo profesor, con "Gestionar Retos" activo) ... --></nav>

  <main>
    <div class="page-header"><h1>Editar Reto</h1></div>
    <div class="form-container">
      <form id="editar-reto-form">
        <div class="form-group"><label for="titulo">Título del Reto</label><input type="text" id="titulo" required></div>
        <div class="form-group"><label for="descripcion">Descripción / Enunciado</label><textarea id="descripcion" required></textarea></div>
        <!-- ... (Aquí irían los campos para el PDF y el enlace, si los quieres editables) ... -->
        <div class="form-group checkbox-group"><input type="checkbox" id="es-reto-actual"><div><label for="es-reto-actual"><strong>Marcar como Reto de la Semana</strong></label></div></div>
        <button type="submit" id="submit-button" class="btn">Guardar Cambios</button>
        <div id="form-message"></div>
      </form>
    </div>
  </main>

  <script>
    const SUPABASE_URL = '...'; // Pega tu URL
    const SUPABASE_ANON_KEY = '...'; // Pega tu Clave Anon
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    let retoId = null;

    async function loadPage() {
        const { data: { session } } = await supabaseClient.auth.getSession();
        if (!session || !await isProfesor(session.user.id)) {
            alert("Acceso denegado.");
            window.location.href = 'dashboard.html';
            return;
        }

        const params = new URLSearchParams(window.location.search);
        retoId = params.get('id');
        if (!retoId) {
            alert("No se especificó un reto para editar.");
            window.location.href = 'gestion_retos.html';
            return;
        }
        
        // Cargar los datos del reto actual
        const { data: reto, error } = await supabaseClient.from('retos').select('*').eq('id', retoId).single();
        if (error || !reto) {
            alert("No se pudo encontrar el reto.");
            window.location.href = 'gestion_retos.html';
            return;
        }

        // Rellenar el formulario con los datos
        document.getElementById('titulo').value = reto.titulo;
        document.getElementById('descripcion').value = reto.descripcion;
        document.getElementById('es-reto-actual').checked = reto.es_reto_actual;
    }
    
    async function isProfesor(userId) { /* ... (función de ayuda como en la otra página) ... */ }

    // Listener para el formulario de EDICIÓN
    document.getElementById('editar-reto-form').addEventListener('submit', async (event) => {
        event.preventDefault();
        
        const updatePayload = {
            titulo: document.getElementById('titulo').value,
            descripcion: document.getElementById('descripcion').value,
            es_reto_actual: document.getElementById('es-reto-actual').checked
        };
        
        const { error } = await supabaseClient
            .from('retos')
            .update(updatePayload)
            .eq('id', retoId);

        if (error) {
            alert("Error al guardar los cambios: " + error.message);
        } else {
            alert("¡Reto actualizado con éxito!");
            window.location.href = 'gestion_retos.html'; // Volver a la lista
        }
    });

    document.addEventListener('DOMContentLoaded', loadPage);
    // Lógica de logout...
  </script>
</body>
</html>
