<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Herramienta de Simulación CDD</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Animación para resaltar la tarjeta actualizada */
        .card-flash {
            animation: flash 1.5s ease-out;
        }
        @keyframes flash {
            0% { background-color: #f0fdf4; border-color: #22c55e; }
            100% { background-color: white; border-color: #e5e7eb; }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-5xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900">Simulador de Competencia Digital Docente</h1>
            <p class="text-md text-gray-600 mt-2">Configura tu estado inicial y simula cómo mejora tu perfil al completar formaciones.</p>
        </header>

        <!-- Paso 1: Configuración Inicial (Visible al principio) -->
        <div id="initial-setup" class="bg-white p-6 rounded-lg shadow-md border border-gray-200 mb-8">
            <h2 class="text-xl font-semibold mb-6 text-center border-b pb-4">1. Configura tu Nivel Inicial</h2>
            <div id="setup-grid" class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4">
                <!-- Los campos de configuración se generarán aquí -->
            </div>
            <button id="save-setup-button" class="w-full bg-green-600 text-white font-bold py-3 px-4 rounded-lg mt-8 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-all">
                Guardar y Empezar a Simular
            </button>
        </div>

        <!-- Contenido principal (Oculto al principio) -->
        <div id="main-content" class="hidden">
            <!-- El grid donde se mostrarán las competencias -->
            <div id="competency-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <!-- Las tarjetas de competencias se generarán dinámicamente aquí -->
            </div>

            <!-- Paso 2: Actualización Manual -->
            <div class="bg-white p-6 rounded-lg shadow-md border border-gray-200">
                <h2 class="text-xl font-semibold mb-4 text-center">2. Simula una Nueva Formación</h2>
                <div class="max-w-xl mx-auto grid grid-cols-1 sm:grid-cols-3 gap-4 items-end">
                    <div class="sm:col-span-2">
                        <label for="area-selector" class="block text-sm font-medium text-gray-700 mb-1">Área a modificar</label>
                        <select id="area-selector" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500"></select>
                    </div>
                    <div>
                        <label for="level-selector" class="block text-sm font-medium text-gray-700 mb-1">Nuevo Nivel</label>
                        <select id="level-selector" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500"></select>
                    </div>
                </div>
                 <button id="update-level-button" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg mt-6 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all">
                    Actualizar Nivel
                </button>
            </div>
        </div>

    </div>

    <footer class="text-center p-4 mt-8 text-sm text-gray-500">
        <p>Creado por Manuel Rodríguez Peñalver, Coordinador TDE y Escuela 4.0</p>
        <p>IES Sierra de los Filabres. (Serón)</p>
    </footer>

<script>
    // --- DATOS Y ESTADO DE LA APLICACIÓN ---

    const levelMap = { 'A1': 1, 'A2': 2, 'B1': 3, 'B2': 4, 'C1': 5, 'C2': 6 };
    const levelOptions = Object.keys(levelMap);

    // Estado inicial de las competencias, ahora es una plantilla. Se llenará con la configuración.
    let competencies = [
        { id: 1, name: 'Compromiso Profesional', level: 'A1' },
        { id: 2, name: 'Contenidos Digitales', level: 'A1' },
        { id: 3, name: 'Enseñanza y Aprendizaje', level: 'A1' },
        { id: 4, name: 'Evaluación y Retroalimentación', level: 'A1' },
        { id: 5, name: 'Empoderamiento del Alumnado', level: 'A1' },
        { id: 6, name: 'Desarrollo de la comp. digital del alumnado', level: 'A1' }
    ];

    // --- ELEMENTOS DEL DOM ---
    const initialSetupSection = document.getElementById('initial-setup');
    const mainContentSection = document.getElementById('main-content');
    const setupGrid = document.getElementById('setup-grid');
    const saveSetupButton = document.getElementById('save-setup-button');
    const competencyGrid = document.getElementById('competency-grid');
    const areaSelector = document.getElementById('area-selector');
    const levelSelector = document.getElementById('level-selector');
    const updateLevelButton = document.getElementById('update-level-button');

    // --- LÓGICA DE RENDERIZADO (DIBUJAR LA INTERFAZ) ---

    function renderCompetencies() {
        competencyGrid.innerHTML = '';
        competencies.forEach(comp => {
            const levelValue = levelMap[comp.level];
            const progressPercentage = (levelValue / 6) * 100;
            const card = document.createElement('div');
            card.className = `bg-white p-5 rounded-lg shadow-md border border-gray-200 transition-all ${comp.updated ? 'card-flash' : ''}`;
            card.innerHTML = `
                <div class="flex justify-between items-start">
                    <h3 class="font-semibold text-gray-800">${comp.id}. ${comp.name}</h3>
                    <span class="font-bold text-lg ${levelValue >= 3 ? 'text-green-600' : 'text-amber-600'}">${comp.level}</span>
                </div>
                <div class="mt-4">
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div class="bg-green-600 h-2.5 rounded-full" style="width: ${progressPercentage}%"></div>
                    </div>
                    <div class="text-xs text-gray-500 mt-1 flex justify-between">
                        <span>A1</span>
                        <span>C2</span>
                    </div>
                </div>
            `;
            competencyGrid.appendChild(card);
            if (comp.updated) delete comp.updated;
        });
    }

    // --- LÓGICA DE INICIALIZACIÓN Y CONFIGURACIÓN ---

    function initializeSetupForm() {
        competencies.forEach(comp => {
            // Crear contenedor para cada fila de configuración
            const formRow = document.createElement('div');
            formRow.className = 'flex justify-between items-center';
            
            // Etiqueta con el nombre del área
            const label = document.createElement('label');
            label.textContent = `${comp.id}. ${comp.name}`;
            label.className = 'text-sm font-medium text-gray-700';
            label.htmlFor = `setup-level-${comp.id}`;
            
            // Selector de nivel
            const select = document.createElement('select');
            select.id = `setup-level-${comp.id}`;
            select.className = 'w-24 p-1 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500';
            levelOptions.forEach(level => {
                const option = document.createElement('option');
                option.value = level;
                option.textContent = level;
                // Valores por defecto basados en la primera captura de pantalla
                if ((comp.id === 1 || comp.id === 2) && level === 'B1') option.selected = true;
                if (comp.id >= 3 && level === 'A2') option.selected = true;
                select.appendChild(option);
            });

            formRow.appendChild(label);
            formRow.appendChild(select);
            setupGrid.appendChild(formRow);
        });
    }

    function populateUpdateSelectors() {
        // Llenar selector de áreas
        competencies.forEach(comp => {
            const option = document.createElement('option');
            option.value = comp.id;
            option.textContent = `${comp.id}. ${comp.name}`;
            areaSelector.appendChild(option);
        });

        // Llenar selector de niveles
        levelOptions.forEach(level => {
            const option = document.createElement('option');
            option.value = level;
            option.textContent = level;
            levelSelector.appendChild(option);
        });
    }
    
    // --- MANEJADORES DE EVENTOS ---

    saveSetupButton.addEventListener('click', () => {
        // Actualizar el estado de las competencias con los valores del formulario
        competencies.forEach(comp => {
            const select = document.getElementById(`setup-level-${comp.id}`);
            comp.level = select.value;
        });

        // Ocultar configuración y mostrar la app principal
        initialSetupSection.classList.add('hidden');
        mainContentSection.classList.remove('hidden');

        // Renderizar por primera vez y llenar los selectores de actualización
        renderCompetencies();
        populateUpdateSelectors();
        showNotification('Configuración guardada. ¡Listo para simular!', 'info');
    });

    updateLevelButton.addEventListener('click', () => {
        const areaId = parseInt(areaSelector.value);
        const newLevel = levelSelector.value;
        const competencyToUpdate = competencies.find(c => c.id === areaId);

        if (competencyToUpdate) {
            const currentLevelValue = levelMap[competencyToUpdate.level];
            const newLevelValue = levelMap[newLevel];

            if (newLevelValue > currentLevelValue) {
                competencyToUpdate.level = newLevel;
                competencyToUpdate.updated = true; // Marcar para la animación
                renderCompetencies();
                showNotification(`¡Área ${areaId} actualizada a ${newLevel}!`);
            } else {
                showNotification('El nuevo nivel debe ser superior al actual.', 'info');
            }
        }
    });

    // --- FUNCIÓN DE UTILIDAD ---
    function showNotification(message, type = 'success') {
        const notification = document.createElement('div');
        const bgColor = type === 'success' ? 'bg-green-600' : 'bg-blue-500';
        notification.className = `fixed bottom-5 right-5 ${bgColor} text-white py-2 px-4 rounded-lg shadow-xl animate-bounce`;
        notification.textContent = message;
        document.body.appendChild(notification);
        setTimeout(() => {
            notification.remove();
        }, 3000);
    }

    // --- INICIALIZACIÓN DE LA APP ---
    window.onload = () => {
        initializeSetupForm();
    };
</script>

</body>
</html>

